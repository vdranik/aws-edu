*VPC - Virtual Private Cloud*
Виртуальное частное облако (частная сеть)
Позволяет контролировать и регулировать доступ в интернет для тех сервисов, которыми мы хотим пользоваться
Некое простанство внутри AWS, где пользователь размещает свои ресурсы (EC2, RDS, ...)
У хоста VPC есть польный контроль на теми, кто обращается к его ресурсам (расположенным внутри этого VPC)

Глобальная инфраструктура AWS:
- regions (географические зоны, где расположены сервисы Амазон, по всему миру)
  это сделано для того, чтобы пользователи работали с ближайшими региогнами и имели минимальную задержку
- availability zones
  каждый регион делится на зоны доступа (географически изолированные части одного региона в которых располагаются дата-центры Амазон)
  availability zones в пределах одного региона синхронизированы между собой (если одна зона остановится, другая подстрахует блягодаря синхронизации)
Когда мы выбираем какой-либо регион (например, us-east-1), тозапущеный в этом регионе сервис будет запущен в одной из availability zones этого региона

Пример сервиса VPC (как ходит трафик):
VPC (EC2 <--> NACL <---> Route table <---> Internet gateway <--->) Internet

NACL (Network Access Control List) - список контроля доступа к сети (регулирует входящий/исходящий трафик)
Дополнительный уровень защиты для VPC работающий по принципу файревола и фильтрующий трафик, который поступает на одну или более подсетей VPC.
Его привязывают к Subnets.
Имеет Inbound и Outbound rules. Без этих правил весь трафик будет заблокирован.
У правил есть номера (чем ближе к 1, тем приоритетнее правило). Номер * означает последнее правило по умолчанию.
Правила могут как разрешать так и запрещать разные виды трафика по различным ip адресам. Работает поочередно по принципу switch-case - выбирает первый соотв. правилу и остальные игнорирует.
Новосозданный нами NACL не будет иметь правил и соотв. будет блокировать весь трафик.

Route table - аналогичен роутеру в домашней сети, определяет куда направить этот трафик
Набор правил и алгоритмов куда передавать сетевой трафик, определяет остаться ли в частной сети или выйти наружу
Обычно имеет 2 маршрута  по умолчанию: (tagret) local ip adresses и ip adress для выхода в Internet gateway (обычно 0.0.0.0/0, что значит "любой ip"). Если исходящий ip не входит в target local, то он пойдет на target Internet gateway (наружу).
Если открепить Internet gateway от VPC, то Route table все еще будет пытаться перенаправить трафик...но уже в черную дыру.
Нужно не забывать редактировать маршруты!
Чтобы VPC работало, недостаточно прикрепить лишь Internet gateway, нужна и  Route table!
Таблица маршрутов которая создалась по умолчанию считается Main (все подсети по умолчанию прикреплются к главной таблице маршрутов),
если мы хотим подключить подсети к другой табл маршрутов, мы должны подключится к ней в порядке исключения (explicit subnet associations)

NAT Gateway — это служба, которая позволяет вычислительным ресурсам (например, ECS) в частной подсети подключаться к интернету, но не позволяет интернету инициировать соединение с этими ресурсами. Алгоритм работы технологии состоит в том, что когда клиент в сети отправляет какой-то запрос в Интернет, маршрутизатор пересылает запрос специальному устройству. NAT преобразует адрес отправителя в общедоступный IP-адрес устройства перед пересылкой запроса в Интернет  и для дальнейшего получения информации с сервера.
Когда ответ получен от внешнего источника, NAT преобразует общедоступный IP-адрес в частный IP-адрес перед самой пересылкой пакета клиенту.  Для этого NAT создает сопоставление между парой PrivateSrcIP, PrivateSrcPort и парой PublicSrcIP, PublicSrcPort, чтобы знать наверняка, как преобразовать IP-адрес назначения и номер порта назначения возвращающегося трафика. NAT обычно работает на маршрутизаторе или межсетевом экране.

Internet gateway (шлюз) - аналог модема, преобразует сигнал и отправляет его в интернет (и наоборот)
Одна сеть (VPC) может иметь только один прикрепленный шлюз
Если в пределах частной сети  есть активные процессы (EC2, RDS, ...) то шлюз не может быть откреплен

Subnets - раздел VPC, может находиться в рамках только одной availability zone
Есть 2 типа подсетей: private и public
Основное различие это наличие маршрутов (Route tables) в таблице маршрутов открывающих доступ в Internet gateway
У public есть такой маршрут, у  private такого маршрута нет (не могут выходить в интернет, а могут только взаимодействовать с другими сетями в пределах нашего VPC)
Подсети которые не выходят в интернет называются частными
Посетям лучше давать имена  private или public
0.0.0.0/0 - любой/все адреса


Высокая доступность и отказоустойчивость
REGION(VPC(Subnet1(EC2), Subnet2(EC2), Subnet3(RDS)))
Если какая либо зона доступа упадет (например, Subnet1(EC2)), то  другая зона (Subnet2(EC2)) продолжит работать, и потом когда первая зона восстановится, она сможет синхронизировать новые данные из зоны 2.

Высокая доступность - свойство вашей архитектуры, при котором она остается доступной для работы в наибольшее кол. времени. Например, сайт всегда доступен моим клиентам.
Отказоустойчивость - способность системы продолжать работу при возникшей ошибке или нескольких ошибок в ее составляющих.

Нужно стараться размещать ресурсы на разных зонах доступа!